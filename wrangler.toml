#:schema node_modules/wrangler/config-schema.json
name = "ona-prox"
main = "src/index.ts"
compatibility_date = "2026-01-01"
compatibility_flags = ["nodejs_compat"]

routes = [
  { pattern = "prox.spacetimee.xyz", custom_domain = true },
  { pattern = "*.prox.spacetimee.xyz/*", zone_name = "spacetimee.xyz" }
]

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
head_sampling_rate = 1
persist = true

[vars]
# [list]: string list, separated by commas, supporting * + ? wildcards and \\ \* \+ \? escapes
# [object]: key-value pair list, separated by commas, supporting \\ and \, escapes

# ===== Core Settings =====
PROXY_DEPLOY_DOMAIN = ""        # [string] Worker domain (empty: disable subdomain proxy & loop check)
SUBDOMAIN_PROXY_ROOT = ""       # [string] Subdomain proxy base domain (empty: PROXY_DEPLOY_DOMAIN)
SUBDOMAIN_PROXY_SEPARATOR = ""  # [string] Subdomain separator (empty: ".", e.g. "-")
PARAM_PROXY_NAME = "url"        # [string] Query param name for param proxy (recommended: "url")
FALLBACK_PROXY_HOST = ""        # [string] Fallback proxy host (empty: "i.pximg.net")
ROOT_PAGE_URL = ""              # [string] Root page URL (empty: FALLBACK_PROXY_HOST)
ERROR_PAGE_URL = ""             # [string] Error page URL (empty: return 404)
PREFER_HTTP_PROTOCOL = ""       # [flag] Use HTTP by default

# ===== Feature Toggles =====
DISABLE_SUBDOMAIN_PROXY = ""    # [flag] Disable subdomain proxy
DISABLE_PATH_PROXY = ""         # [flag] Disable path proxy
DISABLE_PARAM_PROXY = ""        # [flag] Disable param proxy
DISABLE_FALLBACK_PROXY = ""     # [flag] Disable fallback proxy
DISABLE_PARAM_MERGE = ""        # [flag] Disable query params auto-merge

# ===== URL Format Toggles =====
DISABLE_FULL_PROTOCOL = ""      # [flag] Disable https:// and http://
DISABLE_SEGMENTED_PROTOCOL = "" # [flag] Disable https/ and http/
DISABLE_SHORTHAND_PROTOCOL = "" # [flag] Disable ~/ and -/
DISABLE_IMPLICIT_PROTOCOL = ""  # [flag] Disable // and bare domain

# ===== Header Control =====
DISABLE_REFERER_SPOOF = ""      # [flag] Disable Referer spoofing
REQUEST_HEADERS_RULES = ""      # [object] Request header rules (syntax: Key: value, -Key, Key)
RESPONSE_HEADERS_RULES = ""     # [object] Response header rules (syntax: Key: value, -Key, Key)

# ===== Access Control =====
ALLOWED_HOSTS_LIST = ""         # [list] Target host whitelist
BLOCKED_HOSTS_LIST = ""         # [list] Target host blacklist
ALLOWED_METHODS_LIST = ""       # [list] Method whitelist (e.g. GET, HEAD)
BLOCKED_METHODS_LIST = ""       # [list] Method blacklist (e.g. POST, PUT)
ALLOWED_IPS_LIST = ""           # [list] Client IP whitelist
BLOCKED_IPS_LIST = ""           # [list] Client IP blacklist
ALLOWED_ORIGINS_LIST = ""       # [list] CORS origin whitelist
BLOCKED_ORIGINS_LIST = ""       # [list] CORS origin blacklist

# ===== Logging & Debug =====
DISABLE_LOGGER_OUTPUT = ""      # [flag] Disable request logging
DISABLE_REDIRECT_FOLLOW = ""    # [flag] Disable redirect following
